# IMG to VIDEO Workflow - WebUI Wrapper v2.0
# Redesigned with extensible component architecture and section-based layout
# Changes to this file will be reflected when the workflow is reloaded in the Create tab

name: "IMG to VIDEO"
description: "Generate video from a single image using WAN 2.2 Image-to-Video model with high/low noise dual sampling"
version: "2.0.0"
category: "video"
tags:
  - image-to-video
  - wan-2.2
  - video-generation
  - 14B-model

# Workflow JSON file reference (relative to this file)
workflow_file: "IMG to VIDEO.json"

# Thumbnail/preview image (optional)
thumbnail: null

# Estimated VRAM requirement
vram_estimate: "24GB"

# Estimated generation time (in seconds, approximate)
time_estimate:
  min: 120
  max: 600
  note: "Varies significantly based on duration and resolution"

# UI Layout Configuration - Section-based layout for organized UI
layout:
  sections:
    - id: "basic"
      title: "ğŸ“ Basic Settings"
      collapsed: false
      
    - id: "generation"
      title: "âš™ï¸ Generation Parameters"
      collapsed: false
      
    - id: "models"
      title: "ğŸ¯ Model Selection"
      collapsed: false
      
    - id: "features"
      title: "ğŸ”§ Advanced Features"
      collapsed: true

# Input fields organized by section
inputs:
  # === BASIC SETTINGS ===
  - id: "input_image"
    section: "basic"
    node_id: "88"
    field: "image"
    type: "image"
    label: "Input Image"
    description: "Source image to animate. Will be resized to fit the selected output size."
    required: true
    accept: "image/png,image/jpeg,image/webp"
    max_size_mb: 10

  - id: "positive_prompt"
    section: "basic"
    node_id: "408"
    field: "value"
    type: "textarea"
    label: "Positive Prompt"
    description: "Describe the motion and style you want in the video"
    required: true
    default: "The subject moves naturally with smooth cinematic motion, high quality, detailed"
    placeholder: "Describe the desired motion and style..."
    max_length: 2000
    rows: 4

  - id: "negative_prompt"
    section: "basic"
    node_id: "409"
    field: "value"
    type: "textarea"
    label: "Negative Prompt"
    description: "What to avoid in the generation"
    required: false
    default: "è‰²è°ƒè‰³ä¸½ï¼Œè¿‡æ›ï¼Œé™æ€ï¼Œç»†èŠ‚æ¨¡ç³Šä¸æ¸…ï¼Œå­—å¹•ï¼Œé£æ ¼ï¼Œä½œå“ï¼Œç”»ä½œï¼Œç”»é¢ï¼Œé™æ­¢ï¼Œæ•´ä½“å‘ç°ï¼Œæœ€å·®è´¨é‡ï¼Œä½è´¨é‡ï¼ŒJPEGå‹ç¼©æ®‹ç•™ï¼Œä¸‘é™‹çš„ï¼Œæ®‹ç¼ºçš„ï¼Œå¤šä½™çš„æ‰‹æŒ‡ï¼Œç”»å¾—ä¸å¥½çš„æ‰‹éƒ¨ï¼Œç”»å¾—ä¸å¥½çš„è„¸éƒ¨ï¼Œç•¸å½¢çš„ï¼Œæ¯å®¹çš„ï¼Œå½¢æ€ç•¸å½¢çš„è‚¢ä½“ï¼Œæ‰‹æŒ‡èåˆï¼Œé™æ­¢ä¸åŠ¨çš„ç”»é¢ï¼Œæ‚ä¹±çš„èƒŒæ™¯ï¼Œä¸‰æ¡è…¿ï¼ŒèƒŒæ™¯äººå¾ˆå¤šï¼Œå€’ç€èµ°, fast movements, blurry, mouth moving, talking, teeth visible, strong blush"
    rows: 3

  - id: "seed"
    section: "basic"
    node_id: "73"
    field: "noise_seed"
    type: "seed"
    label: "Seed"
    description: "Random seed for reproducibility (-1 for random)"
    randomize_button: true
    default: -1
    control_after_generate: "randomize"

  # === GENERATION PARAMETERS ===
  - id: "custom_size"
    section: "generation"
    node_id: "518"
    field: "value"
    type: "checkbox"
    label: "Use Custom Size"
    description: "Override auto-sizing from input image"
    default: false

  - id: "size_x"
    section: "generation"
    node_id: "83"
    fields:
      - "Xi"
      - "Xf"
    type: "slider"
    label: "Width"
    description: "Output width in pixels"
    min: 512
    max: 1920
    step: 64
    default: 896
    unit: "px"
    depends_on:
      field: "custom_size"
      value: true

  - id: "size_y"
    section: "generation"
    node_id: "83"
    fields:
      - "Yi"
      - "Yf"
    type: "slider"
    label: "Height"
    description: "Output height in pixels"
    min: 512
    max: 1920
    step: 64
    default: 1120
    unit: "px"
    depends_on:
      field: "custom_size"
      value: true

  - id: "duration"
    section: "generation"
    node_id: "426"
    field: "Xi"
    type: "slider"
    label: "Duration"
    description: "Video length in seconds"
    min: 1.0
    max: 10.0
    step: 0.5
    default: 5.0
    unit: "seconds"

  - id: "steps"
    section: "generation"
    node_id: "82"
    fields:
      - "Xi"
      - "Xf"
    type: "slider"
    label: "Steps"
    description: "Denoising steps. Higher = better quality but slower."
    min: 10
    max: 40
    step: 1
    default: 20

  - id: "cfg"
    section: "generation"
    node_id: "85"
    fields:
      - "Xi"
      - "Xf"
    type: "slider"
    label: "CFG Scale"
    description: "Prompt adherence strength. Higher = more prompt influence."
    min: 1.0
    max: 10.0
    step: 0.5
    default: 3.5

  - id: "frame_rate"
    section: "generation"
    node_id: "490"
    field: "Xi"
    type: "slider"
    label: "Frame Rate"
    description: "Output frames per second"
    min: 8.0
    max: 24.0
    step: 1.0
    default: 16.0
    unit: "FPS"

  - id: "speed"
    section: "generation"
    node_id: "157"
    fields:
      - "Xi"
      - "Xf"
    type: "slider"
    label: "Sampling Speed"
    description: "ModelSamplingSD3 shift parameter"
    min: 1.0
    max: 15.0
    step: 0.5
    default: 7.0

  - id: "upscale_ratio"
    section: "generation"
    node_id: "421"
    fields:
      - "Xi"
      - "Xf"
    type: "slider"
    label: "Upscale Ratio"
    description: "Scale factor for upscaling"
    min: 1.0
    max: 4.0
    step: 0.5
    default: 1.5

  # === MODEL SELECTION ===
  # Note: These use advanced component types that scan the remote instance for available models
  - id: "main_model"
    section: "models"
    node_ids:
      - "522"  # high noise loader
      - "523"  # low noise loader
    type: "high_low_pair_model"
    label: "Main Model (High/Low Noise Pair)"
    description: "Diffusion model pair for generation. Click refresh to scan instance for available models."
    required: true
    model_type: "diffusion_models"
    default_high: "Wan-2.2_ComfyUI_repackaged/wan2.2_i2v_high_noise_14B_fp16.safetensors"
    default_low: "Wan-2.2_ComfyUI_repackaged/wan2.2_i2v_low_noise_14B_fp16.safetensors"

  - id: "loras"
    section: "models"
    node_ids:
      - "416"  # high noise LoRA loader
      - "471"  # low noise LoRA loader
    type: "high_low_pair_lora_list"
    label: "LoRAs (High/Low Noise Pairs)"
    description: "Add LoRAs for style/motion control. Each LoRA should have high/low noise variants."
    required: false
    model_type: "loras"
    max_items: 5

  - id: "clip_model"
    section: "models"
    node_id: "460"
    field: "clip_name"
    type: "single_model"
    label: "CLIP Model"
    description: "Text encoder model"
    required: true
    model_type: "text_encoders"
    default: "Wan-2.2/umt5_xxl_fp16.safetensors"

  - id: "vae_model"
    section: "models"
    node_id: "461"
    field: "vae_name"
    type: "single_model"
    label: "VAE Model"
    description: "Variational autoencoder"
    required: true
    model_type: "vae"
    default: "Wan-2.1/wan_2.1_vae.safetensors"

  - id: "upscale_model"
    section: "models"
    node_id: "384"
    field: "model_name"
    type: "single_model"
    label: "Upscale Model"
    description: "Super-resolution model for upscaling"
    required: true
    model_type: "upscale_models"
    default: "RealESRGAN_x4plus.pth"

  # === ADVANCED FEATURES ===
  - id: "save_last_frame"
    section: "features"
    category: "Video Output"
    type: "checkbox"
    label: "Save Last Frame"
    description: "Save the final frame as a separate image"
    default: false

  - id: "enable_interpolation"
    section: "features"
    category: "Video Output"
    node_id: "431"
    type: "checkbox"
    label: "Enable Interpolation"
    description: "Use RIFE for frame interpolation"
    default: false

  - id: "enable_upscaler"
    section: "features"
    category: "Video Output"
    type: "checkbox"
    label: "Enable Upscaler"
    description: "Apply upscaling without interpolation"
    default: false

  - id: "enable_upscale_interpolation"
    section: "features"
    category: "Video Output"
    type: "checkbox"
    label: "Enable Upscale + Interpolation"
    description: "Apply both upscaling and interpolation"
    default: true

  - id: "enable_video_enhancer"
    section: "features"
    category: "Quality"
    node_ids:
      - "481"
      - "482"
    type: "checkbox"
    label: "Video Enhancer"
    description: "WanVideoEnhanceAVideoKJ for quality enhancement"
    default: true

  - id: "enable_cfgzerostar"
    section: "features"
    category: "Quality"
    node_ids:
      - "483"
      - "484"
    type: "checkbox"
    label: "CFGZeroStar"
    description: "CFG guidance enhancement for better quality"
    default: true

  - id: "enable_speed_regulation"
    section: "features"
    category: "Quality"
    node_ids:
      - "467"
      - "468"
    type: "checkbox"
    label: "Speed Regulation"
    description: "ModelSamplingSD3 speed control"
    default: true

  - id: "enable_normalized_attention"
    section: "features"
    category: "Quality"
    node_ids:
      - "485"
      - "486"
    type: "checkbox"
    label: "Normalized Attention"
    description: "WanVideoNAG for normalized attention"
    default: true

  - id: "enable_magcache"
    section: "features"
    category: "Performance"
    node_ids:
      - "505"
      - "506"
    type: "checkbox"
    label: "MagCache"
    description: "Memory optimization via caching"
    default: true

  - id: "enable_torchcompile"
    section: "features"
    category: "Performance"
    type: "checkbox"
    label: "TorchCompile"
    description: "JIT compilation (experimental, may not work on all systems)"
    default: false

  - id: "enable_blockswap"
    section: "features"
    category: "Performance"
    node_ids:
      - "500"
      - "501"
    type: "checkbox"
    label: "BlockSwap"
    description: "VRAM reduction via model offloading"
    default: true

  - id: "vram_reduction"
    section: "features"
    category: "Performance"
    node_id: "502"
    fields:
      - "Xi"
      - "Xf"
    type: "slider"
    label: "VRAM Reduction"
    description: "Percentage of model offloading. 0% = fastest (most VRAM), 100% = slowest (least VRAM)"
    min: 0
    max: 100
    step: 10
    default: 100
    unit: "%"
    depends_on:
      field: "enable_blockswap"
      value: true

# Output configuration
outputs:
  - id: "original_video"
    node_id: "398"
    type: "video"
    format: "mp4"
    label: "Original Video"
    description: "Video at native frame rate with color matching"

  - id: "interpolated_video"
    node_id: "433"
    type: "video"
    format: "mp4"
    label: "Interpolated Video"
    description: "Video with frame interpolation using RIFE"
    depends_on:
      field: "enable_interpolation"
      value: true

# Model requirements (for validation and display)
requirements:
  models:
    - type: "unet"
      name: "WAN 2.2 High Noise 14B"
      path: "Wan-2.2_ComfyUI_repackaged/wan2.2_i2v_high_noise_14B_fp16.safetensors"
      size_gb: 27.8
    - type: "unet"
      name: "WAN 2.2 Low Noise 14B"
      path: "Wan-2.2_ComfyUI_repackaged/wan2.2_i2v_low_noise_14B_fp16.safetensors"
      size_gb: 27.8
    - type: "clip"
      name: "UMT5 XXL"
      path: "Wan-2.2/umt5_xxl_fp16.safetensors"
      size_gb: 9.8
    - type: "vae"
      name: "WAN 2.1 VAE"
      path: "Wan-2.1/wan_2.1_vae.safetensors"
      size_gb: 0.2
    - type: "upscale"
      name: "RealESRGAN x4 Plus"
      path: "upscale_models/RealESRGAN_x4plus.pth"
      size_gb: 0.06
    - type: "rife"
      name: "RIFE 4.7"
      path: "rife/rife47.pth"
      size_gb: 0.1

  custom_nodes:
    - name: "ComfyUI-VideoHelperSuite"
      repo: "https://github.com/Kosinkadink/ComfyUI-VideoHelperSuite"
      required: true
    - name: "ComfyUI-KJNodes"
      repo: "https://github.com/kijai/ComfyUI-KJNodes"
      required: true
    - name: "rgthree-comfy"
      repo: "https://github.com/rgthree/rgthree-comfy"
      required: true
    - name: "ComfyUI-mxToolkit"
      repo: "https://github.com/Intersection98/ComfyUI_mxToolkit"
      required: true
    - name: "ComfyUI-WanVideoWrapper"
      repo: "https://github.com/kijai/ComfyUI-WanVideoWrapper"
      required: true
    - name: "ComfyUI-Easy-Use"
      repo: "https://github.com/yolain/ComfyUI-Easy-Use"
      required: true

  vram: "24GB minimum (48GB recommended for longer videos)"
  compute: "NVIDIA GPU with CUDA support"

# Presets for quick configuration
presets:
  - name: "Quick Preview"
    description: "Fast generation for testing"
    values:
      duration: 2
      steps: 15
      frame_rate: 12
      vram_reduction: 100
      enable_upscale_interpolation: false
      enable_interpolation: false

  - name: "High Quality"
    description: "Best quality, slower generation"
    values:
      duration: 5
      steps: 30
      frame_rate: 24
      upscale_ratio: 2.0
      vram_reduction: 0
      enable_upscale_interpolation: true

  - name: "Balanced"
    description: "Good balance of quality and speed"
    values:
      duration: 5
      steps: 20
      frame_rate: 16
      vram_reduction: 50
      enable_upscale_interpolation: true
